## 技术关键点思考与经验认识

### 1)JVM

JVM里的关键点，主体是**GC的选择与参数设置**，这些要求开发人员掌握JVM内存模型，GC类型，设置的参数，GC日志的解读，以及工具与命令的使用。

学习JVM主体是为了解决针对特定（生产）环境，选择合适的GC，并设置合适堆栈内存以及GC其他参数，并在程序过程中避免内存泄漏和内存溢出的问题，最终减少整个程序的GC次数。一次都不GC是不可能的，但是通过选择不同的GC和参数设置，可以GC频率和暂停时长，这对程序时非常重要的。

经验之谈：

- JVM堆内存设置到机器总内存的70%~75%，因为还有非堆与堆外内存的存在；
- 发生频繁GC有可能是过早提升引起，可以根据课上讲的症状进行判断，解决起来是让年轻代能放下临时数据即可。

### 2)NIO

NIO里的关键点，主体是**netty**，这要求开发人员理解原始socket通信是什么样子，之后IO模型演进的过程中，如何提升了IO效率。这里netty基于NIO，事件驱动的异步网络应用开发框架。

netty中将socket连接和数据处理分开，由boss group负责接收外部连接，然后分发给worker group，worker group会给到某个具体的EventLoop处理，它将任务交给当前Channel去做，Channel就按PipleLine中的ChannelHandler一个一个处理。

经验之谈：

- 当使用到netty实现网络应用开发，一定不要阻塞EventLoop。
- 另外缓存区，心跳机制也需要根据实际发包频率，进行调节，网络传输最大传输单元是1500Byte，其中数据最大占1460，如果单次发送数据量少，且发送频率高，这不仅浪费网络传输资源，还容易造成网络阻塞。

### 3) 并发编程

并发编程里的关键点，主体是**JUC包和线程池的使用**，这些要求开发人员知道线程创建的方式，常用方法以及线程的状态，使用线程池更好的管理多线程，另外为了解决多线程执行时产生的并发问题（原子性，可见性以及有序性），JUC提供了synchronized，volatile，锁以及工具类。

JUC中提供了Lock，Condition，ReadWriteLock等锁机制类，AtomicXxx的原子操作类，CountDownLatch, CyclicBarrier, Semaphore  信号量类以及并发的集合类。

经验之谈：

- 锁的粒度，锁与性能平衡，锁的可重入性，是否需要公平，乐观锁的自旋
- 线程共享与协作，Lock与synchronized，Future/Callable，Thread#join()，CountdownLatch以及CyclicBarrier

### 4)Spring 和 ORM 等框架

Spring和ORM框架里的关键点，主体是**Spring，Spring Boot以及MyBatis**，另外介绍了java8特性，Guava工具包，并扩展了设计原则和设计模式，再捎带了单元测试。

Spring改变了传统web项目的结构，分出了Controller，Service，DAO，Model层，并通过IOC，Spring Bean让对象的创建销毁可以完全托管给Spring容器，Bean的配置和使用通常有XML和注解两种，而注解在Spring Boot开始之后，成为了主流的一种方式。Spring Boot的核心思想是约定大于配置，让一切变得简化，这得利于自动化配置；另一方面，由于成熟的第三方组件集成经验，各种spring-boot-starter，这构建了一套快速配置的脚手架，开发起来如此丝滑。

ORM框架最常见的是Hibernate和MyBatis，Hibernate旨在让开发人员从SQL语句中解放开来，由框架内构建SQL，俗称全自动化；而MyBatis则将SQL的编写交由开发人员，俗称半自动化，当然它有其他配合的工具，能够自动生成操作数据的XML配置。

经验之谈：

- 本地事务，如果事务超出了Spring事务的管理范围，则Spring事务的设置无法生效
- 多数据源，使用时一定要指定使用的是哪个数据源
- 连接池的配置，池的大小不能太大，几十以内可以，尽可能的设置心跳和重连，避免应用需要人工重启，还有就是超时时间
- ORM内尽量避免复杂SQL，级联查询，一方面有可能锁表，另一方有可能捞出来太多不需要数据
- ORM辅助工具与插件，这部分按照业务简单还是复杂取舍，如果业务复杂，尽量少用这类插件工具

### 5)MySQL 数据库和 SQL

Mysql数据库和SQL里的关键点，主体是**SQL优化，事务与锁**，这里由浅入深，介绍数据库原理，表设计原则，事务和锁，进入具体到SQL优化，配合优化，最后扩展到数据库的集群相关问题。

SQL语言是结构化查询语言，包含六类，但常用的是查询，操作和定义语言；MySQL数据库可以使用SQL语言进行操作，它的表设计有设计范式，用来约束表的设计合理性，但不是必须如此。MySQL一个简化的执行流程，包含查询缓存（8.0之后没有了），解析器解析语句，然后预处理，再是查询优化器进行优化，执行计划，最后查询执行引擎并调用api进行数据操作。这里需要着重学习MySQL索引，它是使用B+树来检索，如果想索引检索够快，那么尽量减少树高。

MySQL事务可靠性模型，具有原子性，一致性，隔离性以及持久性，由事务扩展出四种隔离级别，它保证可靠性的机制，undo log以及redo log。在对数据进行操作，与多线程相同，也有锁的概念，这里有表级锁和行级锁。

经验之谈：

- 参数配置优化，可以调节连接请求，缓冲区，（常用）Innodb引擎参数设置
- 数据库表设计，数据类型尽量明确和小，少用外键和触发器，适当可以增加冗余字段，避免物理删除记录，时间戳的字段大多数情况可以考虑加上
- 写入优化，多使用PreparedStatement减少SQL解析 ，多使用批操作，减少交互
- 数据更新，避免gap lock，避免锁范围扩大，减少范围更新
- 查询优化，使用like时字符串开头不能模糊查询，尽量利用前缀匹配，全文检索尽量使用专职解决方案，比如ES；连接查询，避免笛卡尔积查询
- 索引失效，像条件中NULL，not，not in，以及使用函数，另外减少使用or
- 查询数量与次数，根据业务平衡这两者，避免使用临时文件排序或临时表，避免不必须的重复数据传输

### 6)分库分表



### 7)RPC 和微服务



### 8) 分布式缓存



### 9) 分布式消息队列



-63
